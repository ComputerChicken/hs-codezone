<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coding Comp</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body id="body">
    <div id="the-bar">
        <div id="leaderboard-wrapper" onclick="window.location = './leaderboard.html'">
            Leaderboard
        </div>
        <div id="logout-wrapper" onclick="logout()">
            Logout
        </div>
        <div id="home-wrapper" onclick="window.location = './index.html'">
            Home
        </div>
        <div id="points-wrapper">
            Points: 
        </div>
    </div>
</body>
<script type="module">
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js'
    import { doc, getDoc, getFirestore } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js'
    
    const firebaseConfig = {
        apiKey: "AIzaSyD7USXryTnEIHRxISXxCOQdyD4q7puHuvw",
        authDomain: "codezonehs.firebaseapp.com",
        projectId: "codezonehs",
        storageBucket: "codezonehs.firebasestorage.app",
        messagingSenderId: "564878006133",
        appId: "1:564878006133:web:3acb0b826b57a03943e53c",
        measurementId: "G-B6CZYS7LRS"
    };

    const app = initializeApp(firebaseConfig);

    const auth = getAuth(app);

    const db = getFirestore(app)

    const docRef = doc(db, "problems", "problems");
    const docSnap = await getDoc(docRef);
    const docData = docSnap.data();

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userDoc = doc(db, "users", user.uid);
            const userDocSnap = await getDoc(userDoc);
            const userDocData = userDocSnap.data()

            document.getElementById("points-wrapper").textContent = "Points: " + userDocData["points"]
        } else {
            window.location = "./signin.html"
        }
    });

    const diffs = ["Easy","Medium","Hard","Extreme","Impossible"]

    Object.keys(docData).forEach((key) => {
        const problemContainer = document.createElement("div")
        problemContainer.className = "problem-container"
        problemContainer.onclick = function() {window.location = "./problem.html?name=" + key}

        const problemNameWrapper = document.createElement("div")
        problemNameWrapper.className = "problem-name-wrapper"
        problemNameWrapper.textContent = docData[key]["NAME"]

        const difficultyWrapper = document.createElement("div")
        let diff = diffs[docData[key]["DIFF"]]
        difficultyWrapper.className = diff + "-wrapper"
        difficultyWrapper.textContent = diff

        const descWrapper = document.createElement("div")
        descWrapper.className = "desc-wrapper"
        descWrapper.textContent = docData[key]["DESC"]

        problemContainer.appendChild(problemNameWrapper)
        problemContainer.appendChild(difficultyWrapper)
        problemContainer.appendChild(descWrapper)

        document.getElementById("body").appendChild(problemContainer)
    })

    function logout() {
        signOut(auth);
    }

    window.logout = logout
</script>
</html>