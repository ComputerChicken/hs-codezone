<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
    <div style="font-weight: 750; width: 100%;">
        Add problem
    </div>
    <input placeholder="ID" id="id">
    <br>
    <input placeholder="Name" id="name">
    <br>
    <input placeholder="Description" id="desc">
    <br>
    <input placeholder="Difficulty" id="diff">
    <br>
    <input placeholder="Test input 1" id="test1">
    <br>
    <input placeholder="Test input 2" id="test2">
    <br>
    <input placeholder="Test input 3" id="test3">
    <br>
    <input type="file" id="add-problem-file-inp">
    <br>
    <button onclick="addProblem()">Add</button>
</body>
<script type="module">
    import { runPython } from "./pyjs.js"
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js'
    import { doc, getDoc, getFirestore, updateDoc, increment } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js'
    
    const firebaseConfig = {
        apiKey: "AIzaSyD7USXryTnEIHRxISXxCOQdyD4q7puHuvw",
        authDomain: "codezonehs.firebaseapp.com",
        projectId: "codezonehs",
        storageBucket: "codezonehs.firebasestorage.app",
        messagingSenderId: "564878006133",
        appId: "1:564878006133:web:3acb0b826b57a03943e53c",
        measurementId: "G-B6CZYS7LRS"
    };

    const app = initializeApp(firebaseConfig);

    const auth = getAuth(app);

    const db = getFirestore(app);

    async function addProblem(params) {
        const fileInp = document.getElementById("add-problem-file-inp")
        const file = fileInp.files[0]; // Get the first selected file
        const testInps = [document.getElementById("test1").value,document.getElementById("test2").value,document.getElementById("test3").value]
        var testOuts = []
        if (file) {
            const reader = new FileReader();

            reader.onload = async function(event) {
                testOuts.push(await runPython(event.target.result, testInps[0]))
                testOuts.push(await runPython(event.target.result, testInps[1]))
                testOuts.push(await runPython(event.target.result, testInps[2]))

                const id = document.getElementById("id").value
                const name = document.getElementById("name").value
                const diff = parseInt(document.getElementById("diff").value)
                const desc = document.getElementById("desc").value
                var data = {}
                data[id] = {"NAME":name, "DIFF":diff, "DESC":desc}
                console.log(testOuts)
                data[id][testInps[0]] = testOuts[0]
                data[id][testInps[1]] = testOuts[1]
                data[id][testInps[2]] = testOuts[2]
                console.log(data)
                await updateDoc(doc(db, "problems", "problems"), data)
            };
            reader.readAsText(file);
        }
        
    }

    window.addProblem = addProblem
</script>
</html>